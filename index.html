<!DOCTYPE html>
<html>
  <head>
    <title>WebAR | UFactory & ABB con sonido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
    <style>
      html, body { margin:0; padding:0; overflow:hidden; touch-action:none; font-family:system-ui, sans-serif; background:#000; }
      #overlay {
        position:fixed; inset:0; background:rgba(0,0,0,.85); color:#fff;
        display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999;
      }
      #overlay button { background:#ff3333; color:#fff; border:0; padding:12px 20px; font-size:18px; border-radius:8px; cursor:pointer; }
      #overlay button:hover { background:#ff5555; }
    </style>
  </head>

  <body>
    <!-- BotÃ³n para habilitar audio -->
    <div id="overlay">
      <p>ðŸŽ§ Toca para habilitar el audio y reproducir los videos</p>
      <button id="startBtn">Iniciar</button>
    </div>

    <a-scene embedded arjs>
      <a-assets>
        <!-- Videos (con espacios codificados) -->
        <video id="vidUFactory"
               src="Ufactory%20video%20edit.mp4"
               preload="auto"
               playsinline webkit-playsinline
               loop></video>

        <video id="vidABB"
               src="ABB%20VIDEO%20EDITADO.mp4"
               preload="auto"
               playsinline webkit-playsinline
               loop></video>
      </a-assets>

      <!-- Marcador 1: UFactory -->
      <a-marker id="markerUFactory" type="pattern" url="pattern-image1.patt">
        <a-video src="#vidUFactory"
                 width="1" height="2"
                 position="0 0 0"
                 rotation="-90 0 0"
                 loop="true"></a-video>
        <a-text value="UFactory Light 6"
                position="0 1.2 0"
                rotation="-90 0 0"
                scale="0.45 0.45 0.45"
                color="cyan"></a-text>
      </a-marker>

      <!-- Marcador 2: ABB -->
      <a-marker id="markerABB" type="pattern" url="pattern-image2.patt">
        <a-video src="#vidABB"
                 width="1" height="2"
                 position="0 0 0"
                 rotation="-90 0 0"
                 loop="true"></a-video>
        <a-text value="ABB IRB 140"
                position="0 1.2 0"
                rotation="-90 0 0"
                scale="0.45 0.45 0.45"
                color="orange"></a-text>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const overlay = document.getElementById('overlay');
      const startBtn = document.getElementById('startBtn');

      const vidUFactory = document.getElementById('vidUFactory');
      const vidABB      = document.getElementById('vidABB');

      const markerUFactory = document.getElementById('markerUFactory');
      const markerABB      = document.getElementById('markerABB');

      // Recomendado: asegurar flags tambiÃ©n por JS
      [vidUFactory, vidABB].forEach(v => {
        v.playsInline = true;
        v.setAttribute('playsinline', '');
        v.setAttribute('webkit-playsinline', '');
      });

      // Reproducir con sonido tras interacciÃ³n del usuario
      startBtn.addEventListener('click', async () => {
        try {
          await Promise.all([vidUFactory.play(), vidABB.play()]);
          overlay.style.display = 'none';
        } catch (err) {
          alert('No se pudo iniciar con sonido: ' + err.message);
        }
      });

      // Cada marcador controla su propio video
      markerUFactory.addEventListener('markerFound', () => { if (vidUFactory.paused) vidUFactory.play(); });
      markerUFactory.addEventListener('markerLost',  () => { vidUFactory.pause(); });

      markerABB.addEventListener('markerFound', () => { if (vidABB.paused) vidABB.play(); });
      markerABB.addEventListener('markerLost',  () => { vidABB.pause(); });

      // Extra: si quieres que SOLO suene el que estÃ¡ visible, descomenta:
      /*
      markerUFactory.addEventListener('markerFound', () => { vidABB.muted = true; vidUFactory.muted = false; });
      markerABB.addEventListener('markerFound', () => { vidUFactory.muted = true; vidABB.muted = false; });
      // Al perder ambos, puedes mutear ambos si gustas:
      markerUFactory.addEventListener('markerLost', () => { vidUFactory.muted = true; });
      markerABB.addEventListener('markerLost', () => { vidABB.muted = true; });
      */
    </script>
  </body>
</html>
