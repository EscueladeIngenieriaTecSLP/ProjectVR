<!DOCTYPE html>
<html>
  <head>
    <title>UR3 WebAR con sonido (2 videos)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- LibrerÃ­as -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
    <style>
      body, html { margin:0; padding:0; overflow:hidden; touch-action:none; font-family:system-ui, sans-serif; }
      #overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,.85); color:#fff;
        display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999;
      }
      #overlay button {
        background:#ff3333; color:#fff; border:none; padding:12px 20px; font-size:18px; border-radius:8px; cursor:pointer;
      }
      #overlay button:hover { background:#ff5555; }
    </style>
  </head>

  <body>
    <!-- Overlay para habilitar audio -->
    <div id="overlay">
      <p>ðŸŽ§ Toca para iniciar los videos con sonido</p>
      <button id="startBtn">Reproducir</button>
    </div>

    <!-- Escena AR -->
    <a-scene embedded arjs>
      <a-assets>
        <!-- Video 1 (UR3) mantiene tus nombres -->
        <video id="ur3video"
               src="ur3-video.mp4"
               preload="auto"
               playsinline webkit-playsinline
               loop></video>

        <!-- Video 2 (ABB) usa tus nombres del repo (espacios codificados) -->
        <video id="abbVideo"
               src="ABB%20VIDEO%20EDITADO.mp4"
               preload="auto"
               playsinline webkit-playsinline
               loop></video>
      </a-assets>

      <!-- Marcador 1: usa marker.patt (tu actual) -->
      <a-marker type="pattern" url="marker.patt" id="markerUR3">
        <a-video src="#ur3video" width="1" height="2" position="0 0 0" rotation="-90 0 0" loop="true"></a-video>
        <a-text value="UR3: 6 DOF | 3kg | 500mm reach"
                position="0 1.2 0" rotation="-90 0 0" scale="0.4 0.4 0.4" color="red"></a-text>
      </a-marker>

      <!-- Marcador 2: ABB con pattern-image2.patt -->
      <a-marker type="pattern" url="pattern-image2.patt" id="markerABB">
        <a-video src="#abbVideo" width="1" height="2" position="0 0 0" rotation="-90 0 0" loop="true"></a-video>
        <a-text value="ABB IRB 140"
                position="0 1.2 0" rotation="-90 0 0" scale="0.4 0.4 0.4" color="orange"></a-text>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Referencias
      const overlay   = document.getElementById('overlay');
      const startBtn  = document.getElementById('startBtn');
      const ur3Video  = document.getElementById('ur3video');
      const abbVideo  = document.getElementById('abbVideo');
      const markerUR3 = document.getElementById('markerUR3');
      const markerABB = document.getElementById('markerABB');

      // Asegurar flags inline (iOS/Android)
      [ur3Video, abbVideo].forEach(v=>{
        v.playsInline = true;
        v.setAttribute('playsinline','');
        v.setAttribute('webkit-playsinline','');
      });

      // Reproducir con audio tras interacciÃ³n del usuario
      startBtn.addEventListener('click', async () => {
        try {
          await Promise.all([ur3Video.play(), abbVideo.play()]);
          overlay.style.display = 'none';
        } catch (err) {
          alert('No se pudo iniciar con sonido: ' + err.message);
        }
      });

      // Control por marcador: cada uno reproduce/pausa su video
      markerUR3.addEventListener('markerFound', () => { if (ur3Video.paused) ur3Video.play().catch(()=>{}); });
      markerUR3.addEventListener('markerLost',  () => { ur3Video.pause(); });

      markerABB.addEventListener('markerFound', () => { if (abbVideo.paused) abbVideo.play().catch(()=>{}); });
      markerABB.addEventListener('markerLost',  () => { abbVideo.pause(); });

      // OPCIONAL: que solo suene el que estÃ¡ visible
      /*
      markerUR3.addEventListener('markerFound', () => { abbVideo.muted = true; ur3Video.muted = false; });
      markerABB.addEventListener('markerFound', () => { ur3Video.muted = true; abbVideo.muted = false; });
      markerUR3.addEventListener('markerLost',  () => { ur3Video.muted = true; });
      markerABB.addEventListener('markerLost',  () => { abbVideo.muted = true; });
      */
    </script>
  </body>
</html>
