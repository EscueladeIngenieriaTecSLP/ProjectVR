<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>UR3 WebAR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>

  <!-- (Opcional) Componente look-at para que la “pantalla” mire a la cámara siempre -->
  <script src="https://cdn.jsdelivr.net/gh/ngokevin/kframe@master/components/look-at/dist/aframe-look-at-component.min.js"></script>

  <style> body{margin:0;overflow:hidden} </style>
</head>
<body>
  <!-- arjs con debug apagado -->
  <a-scene embedded arjs="debugUIEnabled:false; trackingMethod: best;">
    <!-- Pre-carga de assets -->
    <a-assets>
      <!-- playsinline y webkit-playsinline para iOS; autoplay lo forzamos por JS al encontrar el marker -->
      <video id="ur3video"
             src="ur3-video.mp4"
             preload="auto"
             loop
             muted
             playsinline
             webkit-playsinline
             crossorigin="anonymous">
      </video>
    </a-assets>

    <!-- MARCADOR -->
    <a-marker type="pattern" url="marker.patt" id="marker">

      <!-- Contenedor para orientar la “pantalla” verticalmente -->
      <!-- En AR.js el marcador está “plano” (como mesa). Giramos -90° en X para poner la pantalla de pie -->
      <a-entity id="screenRig" position="0 0 0" rotation="-90 0 0" look-at="[camera]">
        <!-- a-video centrado. Ajusta width/height según tu video -->
        <!-- Si sigue viéndose acostado, cambia la Z de rotation a 90 o -90 justo aquí -->
        <a-video id="screen"
                 src="#ur3video"
                 width="1.0"
                 height="0.56"
                 position="0 0 0.02"
                 rotation="0 0 0">
        </a-video>

        <!-- Texto informativo encima de la pantalla -->
        <a-text value="UR3: 6 DOF, 3kg, 500mm"
                position="0 0.7 0"
                rotation="0 0 0"
                align="center"
                color="red"
                scale="0.5 0.5 0.5">
        </a-text>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Autoplay al detectar marcador; pausa al perderlo (iOS friendly)
    const marker = document.getElementById('marker');
    const video  = document.getElementById('ur3video');

    marker.addEventListener('markerFound', async () => {
      try { 
        // iOS: aseguramos mute para permitir play sin gesto
        video.muted = true; 
        await video.play(); 
      } catch(e) {
        // Si el navegador exige interacción, muestra un toque para iniciar
        console.warn('Necesita interacción para reproducir:', e);
        alert('Toca la pantalla para iniciar el video');
        const start = () => { video.play().finally(() => window.removeEventListener('touchstart', start)); };
        window.addEventListener('touchstart', start, { once:true });
      }
    });

    marker.addEventListener('markerLost', () => {
      video.pause();
    });

    // ---- Si el video aparece "acostado" (90°) ----
    // Cambia la línea rotation del <a-video> arriba a:
    // rotation="0 0 90"   (o)   rotation="0 0 -90"
    // y ajusta width/height si hace falta.
  </script>
</body>
</html>
